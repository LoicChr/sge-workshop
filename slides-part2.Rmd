---
title: "Abacus - Part 2"
author: "Bernat Bramon & Fernando Cagua"
date: "December 15, 2017"
---
  
Let's get into the basics of running jobs to the cluster...

# Queues 

## 

Although the cluster is just like any other computer, the way we run scripts is slightly different.

##

- If everyone ran the jobs directly to the cluster, it would be chaos!

- Jobs would be all running at the same time,

- it would be harder to prevent the cluster from crushing,

- it would be hard to manage multiple users...

##

That's why we need a queueing system...

## The queueing system

- Distributes jobs across nodes/cores

- Makes a waiting list

- Manages job priorities

- Ensures that jobs are contained and the nodes are shieded from possoble errors

- Ensures that jobs are run only within allocated resources (cores/RAM memory/time)

##

The master node hosts the queueing system. That's why we shouldn't run jobs there.

##

If the master node chrashes, the queueing system crashes too. Which means everyone's jobs might go with it. No one can use the cluster until the whole thing is reset. 

# SGE

##

There are multiple quewing systems available. Abacus uses SGE (Sun Grid Engine System). 

##

There are 4 basic commands we'll cover today

```{bash, eval = F}
qsub
qdel
qstat
qalter
```

# qsub

##

To use qsub, we will "always" need a bash script that runs our R scripts.

##

Write with nano a bash script named `script.sh`:

```{bash, eval = F}
#!/bin/bash

Rscript script.R

```
##

Now you should have an R script named `script.R` and a bash script named `script.sh`. Try running the job in the cluster by means of:

```{bash, eval = F}
qsub -cwd -S /bin/bash script.sh
```
##

You will see that two new files have been created in your home directory.

##
`script.sh.o`

This is the output file. Unless Steve messes up with the cluster, you should see the output of the R script inside

##

`script.sh.e`

This is the errors file. Unless Steve messes up with the cluster, you can use it to debug your bash code.

##

You could try changing the Rscript to produce an error:

```{r, eval = F}
Sys.sleep(20)
message("my second job in the cluster")
error <- log("This will produce an error because it is a string")
```


##


# qstat

# qdel

# qalter






